# Logly - 개발자를 위한 블로그 (진행중..)

- 선호하는 스타일의 디자인이 있는 블로그에서 글을 쓰고 싶었습니다.

## Context

### 서비스 최대 규모 예상

[1% 규칙](https://en.wikipedia.org/wiki/1%25_rule)에 따르면 인터넷 커뮤니티에서 1%만이 적극적으로 새로운 컨텐츠를 만든다고 한다.
테스트 하는 현재에는 실제 회원 수나 활성 회원 수 같은 지표가 없으므로 1% 규칙과 대한민국 개발자 인구수를 이용하여 최대한 실 상황과 비슷한 상황을 가정하여 시스템을 설계하도록 한다.

[기사](https://zdnet.co.kr/view/?no=20230425000641&utm_source=chatgpt.com)에 따르면 21년 기준 개발자 인력이 17만명 된다고 한다.
17만명의 유저가 모두 서비스를 사용한다고 가정하더라도, 1% 규칙 적용시 일간 게시글 생성 건수는 1700건이다.
계산하기 편하게 2000건 정도의 데이터가 하루에 추가 된다고 가정 했을 때 1년이면 73만건 3년이면 220만건 5년이면 365만건의 데이터가 쌓인다는 결론이 나온다.

계산의 편의성을 위하여 유저 20만명, 게시글 데이터 400만건의 상황에서 운영 가능한 수준의 성능을 보여주어야 한다.

## Challenge

### 오프셋 기반 페이징 쿼리 커서 기반 페이징으로 전환하기

- Jmeter를 통한 부하 테스트 진행 시 오프셋 기반 페이징에서 마지막 데이터를 조회하는 쿼리의 수행시간이 3000ms로 측정
  - 커서기반 페이징으로 쿼리 변경 250ms로 성능 개선

### 검색 API로 인한 DB CPU 과부하 보호하기

- Full Text Index는 페이징과 같이 사용할 경우 정렬 조건을 위한 인덱스가 우선적으로 사용되어 제대로 된 효과를 보지 못하는 현상 확인
- 400만 게시글 데이터 기준 Table Full Scan 쿼리 수행시간 2~3초 정도로 확인 되어 LIKE를 이용하여 검색 API 구현
- 부하 테스트시 검색 API에 동시 요청이 몰릴 경우 Table Full Scan으로 인한 DB CPU 과부화 현상 확인
- 2vCPU, 4GB Mem 인스턴스 기준 최대 80개의 동시 요청까지 정상 응답을 내려 주는 것 확인
- 캐싱 및 세마 포어를 이용하여 동시 쿼리 개수 제한 하여 DB 인스턴스 보호

### 최저 예산으로 비용 효율적 인프라 구성하기

- 초기에는 트래픽이 거의 없을 것으로 예상 되는 환경에서 비용 효율적인 인프라 구성
- 서비스의 기능이 많아질수록 Labmda의 경우 코드 관리가 어려울 것으로 예상되어 ECS Spot Fargate 선택
- 서비스를 구성하는데 필요한 Database(MySQL, Redis)는 EC2에 직접 설치 후 운영

## TO BE, 발전 방향